container_commands:
  01_migrate:
    command: |
      source /var/app/venv/*/bin/activate
      python manage.py migrate --noinput
    leader_only: true

  02_seed_polls:
    command: |
      source /var/app/venv/*/bin/activate
      python - <<PY
import os, django
os.environ.setdefault("DJANGO_SETTINGS_MODULE", "SEassignment1.settings")
django.setup()
from django.utils import timezone
from polls.models import Question, Choice

# First question
q1, _ = Question.objects.get_or_create(
    question_text="Which framework do you like most?",
    defaults={"pub_date": timezone.now()}
)
Choice.objects.get_or_create(question=q1, choice_text="Django", defaults={"votes": 0})
Choice.objects.get_or_create(question=q1, choice_text="Flask", defaults={"votes": 0})
Choice.objects.get_or_create(question=q1, choice_text="FastAPI", defaults={"votes": 0})

# Second question
q2, _ = Question.objects.get_or_create(
    question_text="Whatâ€™s your favorite programming language?",
    defaults={"pub_date": timezone.now()}
)
Choice.objects.get_or_create(question=q2, choice_text="Python", defaults={"votes": 0})
Choice.objects.get_or_create(question=q2, choice_text="Java", defaults={"votes": 0})
Choice.objects.get_or_create(question=q2, choice_text="JavaScript", defaults={"votes": 0})
PY
    leader_only: true
