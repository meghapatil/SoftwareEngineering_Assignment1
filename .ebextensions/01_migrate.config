container_commands:
  00_remove_stray_db:
    command: rm -f /var/app/current/db.sqlite3 || true
    leader_only: true

  01_create_data_dir:
    command: |
      sudo mkdir -p /var/app/data
      sudo chown -R webapp:webapp /var/app/data
      sudo chmod 775 /var/app/data
    leader_only: true

  02_migrate:
    command: |
      source /var/app/venv/*/bin/activate
      cd /var/app/current
      python manage.py migrate --noinput
    leader_only: true

  03_seed_polls:
    command: |
      source /var/app/venv/*/bin/activate
      cd /var/app/current
      python seed_polls.py
    leader_only: true
